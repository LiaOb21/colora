# Main entrypoint of the workflow.
# Please follow the best practices:
# https://snakemake.readthedocs.io/en/stable/snakefiles/best_practices.html,
# in particular regarding the standardized folder structure mentioned there.


# Main Snakefile

# set config file where you can specify your inputs
configfile: "config/config.yaml"

# import glob to read {sample}
import glob 

#set {samples} wildcard
samples = glob_wildcards(config["hic_path"] + "{sample}_1.fastq.gz").sample

# Include the hifi_prep rule
include: "rules/hifi_prep.smk"
# Include the nanoplot
include: "rules/nanoplot.smk"
# Include the kmc rule
include: "rules/kmc.smk"
# Include the genomescope2 rule
include: "rules/genomescope2.smk"
# Include the oatk rule
include: "rules/oatk.smk"
# Include the hifiasm rule
include: "rules/hifiasm.smk"
# Include the purge_dups rule
include: "rules/purge_dups.smk"
# Include the fastp rule
include: "rules/fastp.smk"


# Define the rule all, which is the default rule that Snakemake runs when no specific rule or target is specified
rule all:
    input:
        "results/reads/hifi/hifi.fastq.gz",  # output of hifi_prep rule
        "results/nanoplot",  # output directory of nanoplot
        "results/kmc/out.hist",  # output of kmc rule
        "results/genomescope",  # output directory of genomescope
        "results/oatk/oatk.asm.mito.ctg.fasta",  # mitochondrion fasta from oatk
        "results/oatk/oatk.asm.pltd.ctg.fasta",  # chloroplast fasta from oatk
        "results/hifiasm/hifiasm.asm.bp.p_ctg.gfa",  # draft hifiasm assembly.gfa
        "results/hifiasm/hifiasm.asm.bp.p_ctg.fa",  # draft hifiasm assembly.fa
        "results/purge_dups/purged.fa",  # purged assembly with purge_dups
        expand("results/fastp/{sample}_report_fastp.HiC.html", sample=samples) # fastp report for HiC reads pre-processing
